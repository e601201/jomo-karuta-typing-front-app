# TASK-203: 入力ハイライト表示 - 要件定義

## 目的

タイピングゲーム中の入力状態を視覚的にフィードバックし、ユーザーが現在の入力位置と正誤を直感的に理解できるようにする。

## 機能要件

### 1. 文字単位のハイライト表示 (REQ-004, REQ-107)

- 各文字の入力状態を色分けして表示
  - **未入力**: グレー（デフォルト）
  - **正解**: 緑色
  - **不正解**: 赤色
  - **現在位置**: カーソル表示または強調
- リアルタイムで表示を更新

### 2. ローマ字表示のハイライト (REQ-108)

- ローマ字ガイドの各文字をハイライト
- 入力済み部分と未入力部分を明確に区別
- 複数の入力パターンがある場合の表示対応

### 3. カーソル位置の表示

- 現在の入力位置を明確に表示
- アニメーション付きカーソル（点滅など）
- 入力可能な次の文字を強調

### 4. エラー表示の強調

- ミスタイプ時の視覚的フィードバック
- エラー箇所の一時的な強調表示
- エラー回数のカウント表示

## UI/UX要件

### 1. 視覚的デザイン

- **色の使い分け**
  - 正解: `#10b981` (green-500)
  - 不正解: `#ef4444` (red-500)
  - 未入力: `#9ca3af` (gray-400)
  - 現在位置: `#3b82f6` (blue-500)
- **フォント**
  - 等幅フォント（font-mono）使用
  - 文字間隔の調整（letter-spacing）

### 2. アニメーション

- **色の遷移**
  - transition-colors（200ms）
  - スムーズな色変更
- **カーソルアニメーション**
  - 点滅: animate-pulse
  - 移動: transition-transform
- **エラー時のシェイク**
  - animate-shake（カスタムアニメーション）

### 3. パフォーマンス

- **レンダリング最適化**
  - 必要な部分のみ再レンダリング
  - Svelte のリアクティビティを活用
- **60fps維持**
  - アニメーション中もスムーズな動作
  - GPU アクセラレーション活用

### 4. アクセシビリティ

- **色覚異常対応**
  - 色だけでなくアイコンや下線でも状態を表現
  - パターンやテクスチャの併用
- **スクリーンリーダー対応**
  - aria-label で状態を説明
  - role 属性の適切な設定
- **高コントラストモード**
  - 境界線の追加
  - より明確な区別

## 技術要件

### 1. コンポーネント設計

```typescript
interface InputHighlightProps {
	text: string; // 表示するテキスト
	inputStates: InputState[]; // 各文字の状態
	currentPosition: number; // 現在の入力位置
	showRomaji?: boolean; // ローマ字表示の有無
	animateErrors?: boolean; // エラーアニメーションの有無
}

type InputState = 'pending' | 'correct' | 'incorrect' | 'current';
```

### 2. 実装構造

```
src/lib/components/game/
├── InputHighlight.svelte       # メインコンポーネント
├── InputHighlight.spec.ts      # テストファイル
└── InputHighlight.css          # カスタムアニメーション（必要に応じて）
```

### 3. 状態管理

- プロップスベースの状態管理
- 親コンポーネントから状態を受け取る
- 内部状態は最小限に抑える

### 4. スタイリング

- Tailwind CSS を使用
- カスタムアニメーションは CSS で定義
- レスポンシブ対応

## 受け入れ基準

### 必須要件

1. [ ] 文字ごとに正解/不正解/未入力が色分けされる
2. [ ] 現在の入力位置が明確に表示される
3. [ ] リアルタイムで表示が更新される
4. [ ] ミスタイプ時に視覚的フィードバックがある
5. [ ] アニメーションがスムーズ（60fps）

### 品質基準

1. [ ] レンダリングパフォーマンスが最適化されている
2. [ ] 色覚異常に配慮したデザイン
3. [ ] モバイルでも見やすい表示
4. [ ] テストカバレッジ 90%以上

## 実装例

### 基本的な使用方法

```svelte
<InputHighlight
  text="つるまうかたちのぐんまけん"
  inputStates={['correct', 'correct', 'pending', ...]}
  currentPosition={2}
  showRomaji={true}
/>
```

### 期待される表示

```
つ る ま う か た ち の ぐ ん ま け ん
✓  ✓  _  _  _  _  _  _  _  _  _  _  _
t  s  u  r  u  m  a  u  ...
```

## パフォーマンス目標

- **初期レンダリング**: < 16ms
- **更新時のレンダリング**: < 8ms
- **アニメーション中のFPS**: 60fps維持
- **メモリ使用量**: < 10MB増加

## テスト戦略

### 単体テスト

- 各状態の表示確認
- プロップスの変更に対する反応
- アニメーションのトリガー

### 視覚的回帰テスト

- スクリーンショット比較
- 各状態の見た目の確認

### パフォーマンステスト

- レンダリング時間の測定
- メモリリークの検出
- FPSの測定

## 将来の拡張性

- カスタムカラーテーマ対応
- 複数の表示モード（コンパクト/詳細）
- 統計情報の表示（WPM、正確率など）
- ゲーミフィケーション要素（コンボエフェクトなど）
