# TASK-203: 入力ハイライト表示 - テストケース設計

## テスト概要

入力ハイライト表示コンポーネントの視覚的フィードバック機能を検証し、パフォーマンスとアクセシビリティを保証する。

## テストカテゴリ

### 1. 基本表示テスト

#### TC-001: 初期状態の表示

- **前提条件**: コンポーネントが初期化される
- **入力データ**:
  ```typescript
  text = 'つるまう';
  inputStates = ['pending', 'pending', 'pending', 'pending'];
  currentPosition = 0;
  ```
- **期待結果**:
  - すべての文字がグレー（pending）で表示される
  - 最初の文字にカーソルが表示される

#### TC-002: 正解文字のハイライト

- **前提条件**: 文字が正しく入力された
- **入力データ**:
  ```typescript
  inputStates = ['correct', 'pending', 'pending', 'pending'];
  currentPosition = 1;
  ```
- **期待結果**:
  - 最初の文字が緑色で表示される
  - 2番目の文字にカーソルが移動

#### TC-003: 不正解文字のハイライト

- **前提条件**: 文字が間違って入力された
- **入力データ**:
  ```typescript
  inputStates = ['correct', 'incorrect', 'pending', 'pending'];
  currentPosition = 1;
  ```
- **期待結果**:
  - 2番目の文字が赤色で表示される
  - エラーアニメーションが実行される

### 2. カーソル表示テスト

#### TC-004: カーソル位置の表示

- **前提条件**: 入力が進行中
- **入力データ**:
  ```typescript
  currentPosition = 2;
  ```
- **期待結果**:
  - 3番目の文字の位置にカーソルが表示される
  - カーソルが点滅アニメーションする

#### TC-005: カーソルの移動

- **前提条件**: 入力位置が変更される
- **入力データ**: currentPosition を 1 から 2 に変更
- **期待結果**:
  - カーソルがスムーズに移動する
  - 移動アニメーションが実行される

### 3. ローマ字表示テスト

#### TC-006: ローマ字ガイドの表示

- **前提条件**: showRomaji = true
- **入力データ**:
  ```typescript
  text = 'つる';
  romaji = 'tsuru';
  showRomaji = true;
  ```
- **期待結果**:
  - ひらがなの下にローマ字が表示される
  - 対応する文字が整列される

#### TC-007: ローマ字のハイライト連動

- **前提条件**: ひらがなが入力される
- **入力データ**:
  ```typescript
  inputStates = ['correct', 'pending'];
  romajiStates = ['correct', 'correct', 'correct', 'pending', 'pending'];
  ```
- **期待結果**:
  - "tsu"部分が緑色でハイライトされる

### 4. アニメーションテスト

#### TC-008: 色遷移アニメーション

- **前提条件**: 状態が変更される
- **テスト手順**: pending → correct に変更
- **期待結果**:
  - 200msで色がスムーズに遷移する
  - ちらつきがない

#### TC-009: エラーシェイクアニメーション

- **前提条件**: エラーが発生
- **入力データ**:
  ```typescript
  animateErrors = true;
  inputStates = ['correct', 'incorrect'];
  ```
- **期待結果**:
  - エラー文字が左右に振動する
  - 500ms後に停止する

#### TC-010: カーソル点滅アニメーション

- **前提条件**: カーソルが表示される
- **期待結果**:
  - カーソルが1秒周期で点滅する
  - opacity が 0 → 1 → 0 と変化

### 5. パフォーマンステスト

#### TC-011: 初期レンダリング速度

- **前提条件**: 50文字のテキスト
- **測定項目**: レンダリング時間
- **期待結果**: < 16ms

#### TC-012: 更新時のレンダリング速度

- **前提条件**: 1文字の状態変更
- **測定項目**: 再レンダリング時間
- **期待結果**: < 8ms

#### TC-013: メモリ使用量

- **前提条件**: 100回の状態更新
- **測定項目**: メモリ増加量
- **期待結果**: < 10MB

#### TC-014: アニメーションFPS

- **前提条件**: 複数のアニメーション同時実行
- **測定項目**: フレームレート
- **期待結果**: 60fps維持

### 6. アクセシビリティテスト

#### TC-015: 色覚異常対応

- **前提条件**: 色覚異常モード有効
- **期待結果**:
  - アイコンや記号で状態を表示
  - パターンで区別可能

#### TC-016: スクリーンリーダー対応

- **前提条件**: スクリーンリーダー使用
- **期待結果**:
  - 各文字の状態が読み上げられる
  - aria-label が適切に設定される

#### TC-017: 高コントラストモード

- **前提条件**: 高コントラストモード有効
- **期待結果**:
  - 境界線が追加される
  - コントラスト比 4.5:1 以上

#### TC-018: キーボードナビゲーション

- **前提条件**: キーボードのみ使用
- **期待結果**:
  - フォーカスが適切に管理される
  - Tab キーで移動可能

### 7. レスポンシブテスト

#### TC-019: モバイル表示

- **前提条件**: 画面幅 375px
- **期待結果**:
  - 文字サイズが適切
  - タッチターゲット 44px 以上

#### TC-020: タブレット表示

- **前提条件**: 画面幅 768px
- **期待結果**:
  - レイアウトが調整される
  - 文字間隔が適切

#### TC-021: デスクトップ表示

- **前提条件**: 画面幅 1280px
- **期待結果**:
  - 大きな文字サイズ
  - 十分な余白

### 8. エッジケーステスト

#### TC-022: 空文字列の処理

- **入力データ**: text = ""
- **期待結果**: エラーなく空表示

#### TC-023: 非常に長いテキスト

- **入力データ**: 200文字のテキスト
- **期待結果**:
  - 適切に折り返される
  - パフォーマンス劣化なし

#### TC-024: 特殊文字の表示

- **入力データ**: "ー" "々" "・"
- **期待結果**: 正しく表示される

#### TC-025: 高速な状態変更

- **テスト手順**: 10ms間隔で状態変更
- **期待結果**:
  - すべての更新が反映される
  - クラッシュしない

### 9. 統合テスト

#### TC-026: ゲーム画面との統合

- **前提条件**: ゲーム画面に組み込み
- **期待結果**:
  - 入力に連動して更新される
  - 他のコンポーネントと干渉しない

#### TC-027: ストアとの連携

- **前提条件**: ゲームストアと接続
- **期待結果**:
  - ストアの状態変更が反映される
  - リアクティブに更新される

### 10. 視覚的回帰テスト

#### TC-028: 各状態のスクリーンショット

- **テスト項目**:
  - pending 状態
  - correct 状態
  - incorrect 状態
  - mixed 状態
- **期待結果**: 基準画像と一致

#### TC-029: アニメーション中のスクリーンショット

- **テスト項目**: 各アニメーションフレーム
- **期待結果**: 滑らかな遷移

## テスト実装優先順位

### 優先度: 高

1. TC-001〜TC-003（基本表示）
2. TC-004〜TC-005（カーソル）
3. TC-011〜TC-012（パフォーマンス）

### 優先度: 中

1. TC-006〜TC-007（ローマ字）
2. TC-008〜TC-010（アニメーション）
3. TC-015〜TC-016（アクセシビリティ）

### 優先度: 低

1. TC-019〜TC-021（レスポンシブ）
2. TC-022〜TC-025（エッジケース）
3. TC-028〜TC-029（視覚的回帰）

## 自動化戦略

- **単体テスト**: Vitest + Testing Library
- **パフォーマンステスト**: カスタム測定ツール
- **視覚的テスト**: Percy または Chromatic
- **アクセシビリティテスト**: axe-core
