# TASK-207: 設定画面 - テストケース設計

## テスト概要

設定画面の全機能を網羅的にテストし、設定の変更、保存、リセット、エクスポート/インポート機能が正しく動作することを保証する。

## テストカテゴリ

### 1. 設定項目の表示テスト

#### TC-001: 設定画面の初期表示

- **操作**: 設定画面を開く
- **期待結果**:
  - すべての設定カテゴリが表示される
  - デフォルト値が正しく表示される
  - UIコンポーネントが適切にレンダリングされる

#### TC-002: 設定カテゴリの切り替え

- **操作**: サイドバーでカテゴリをクリック
- **期待結果**:
  - 選択したカテゴリの設定が表示される
  - アクティブなカテゴリがハイライトされる

#### TC-003: 設定項目の説明表示

- **操作**: 設定項目にホバー/フォーカス
- **期待結果**:
  - ツールチップまたは説明文が表示される
  - 説明内容が正確である

### 2. ゲームプレイ設定テスト

#### TC-004: 部分入力モードの切り替え

- **操作**: 部分入力モードをON/OFF
- **期待結果**:
  - トグルの状態が変更される
  - 関連設定項目が有効/無効になる

#### TC-005: 入力文字数の変更

- **操作**: スライダーで文字数を変更（3-10）
- **期待結果**:
  - 値が正しく更新される
  - 範囲外の値は設定できない

#### TC-006: 表示設定の変更

- **操作**: ローマ字/ひらがな/ヒント表示を切り替え
- **期待結果**:
  - 各設定が独立して動作する
  - 状態が正しく保持される

### 3. サウンド設定テスト

#### TC-007: 効果音のON/OFF

- **操作**: 効果音トグルを切り替え
- **期待結果**:
  - 効果音の有効/無効が切り替わる
  - 音量スライダーの有効/無効が連動

#### TC-008: 音量調整

- **操作**: 音量スライダーを操作（0-100%）
- **期待結果**:
  - 音量値が正しく更新される
  - プレビュー音が再生される（オプション）

#### TC-009: 読み上げ速度の調整

- **操作**: 速度スライダーを操作（0.5x-2.0x）
- **期待結果**:
  - 速度値が正しく更新される
  - 0.1刻みで調整可能

### 4. 表示設定テスト

#### TC-010: フォントサイズの変更

- **操作**: フォントサイズを選択（小/中/大/特大）
- **期待結果**:
  - 選択したサイズが適用される
  - プレビューエリアに反映される

#### TC-011: テーマの切り替え

- **操作**: ライト/ダーク/自動を選択
- **期待結果**:
  - テーマが即座に切り替わる
  - 全画面に適用される

#### TC-012: アニメーション設定

- **操作**: アニメーションON/OFF、速度変更
- **期待結果**:
  - アニメーションの有効/無効が切り替わる
  - 速度が変更される

### 5. 練習設定テスト

#### TC-013: 出題順序の変更

- **操作**: 順番/ランダム/苦手札優先を選択
- **期待結果**:
  - 選択した順序が保存される
  - ラジオボタンが正しく動作

#### TC-014: 繰り返し回数の設定

- **操作**: 1-5回の範囲で設定
- **期待結果**:
  - 数値が正しく設定される
  - 範囲外の値は入力できない

#### TC-015: 制限時間の設定

- **操作**: なし/30秒/60秒/120秒を選択
- **期待結果**:
  - 選択した時間が設定される
  - カスタム時間も設定可能

#### TC-016: 難易度プリセット

- **操作**: 初級/中級/上級を選択
- **期待結果**:
  - 関連する設定が一括で変更される
  - カスタム選択時は個別設定可能

### 6. キーボード設定テスト

#### TC-017: キーボードレイアウトの選択

- **操作**: JIS/USを選択
- **期待結果**:
  - レイアウトが変更される
  - 設定が保存される

#### TC-018: ショートカットキーのカスタマイズ

- **操作**: ショートカットキーを変更
- **期待結果**:
  - 新しいキーが設定される
  - 重複チェックが行われる
  - 無効なキーは設定できない

### 7. データ管理テスト

#### TC-019: 設定の保存

- **操作**: 保存ボタンをクリック
- **期待結果**:
  - 設定がローカルストレージに保存される
  - 成功メッセージが表示される
  - hasChangesフラグがリセットされる

#### TC-020: 設定のキャンセル

- **操作**: キャンセルボタンをクリック
- **期待結果**:
  - 変更が破棄される
  - 元の値に戻る
  - 確認ダイアログが表示される（変更がある場合）

#### TC-021: デフォルトへのリセット

- **操作**: リセットボタンをクリック
- **期待結果**:
  - 確認ダイアログが表示される
  - すべての設定がデフォルト値に戻る
  - 成功メッセージが表示される

#### TC-022: セクション別リセット

- **操作**: 特定セクションのリセットボタンをクリック
- **期待結果**:
  - そのセクションのみリセットされる
  - 他のセクションは影響を受けない

#### TC-023: 設定のエクスポート

- **操作**: エクスポートボタンをクリック
- **期待結果**:
  - JSON形式でダウンロードされる
  - ファイル名に日時が含まれる
  - データが正しくフォーマットされている

#### TC-024: 設定のインポート

- **操作**: JSONファイルをインポート
- **期待結果**:
  - 設定が正しく読み込まれる
  - バリデーションが実行される
  - エラー時は適切なメッセージ

### 8. バリデーションテスト

#### TC-025: 数値入力の範囲チェック

- **入力**: 範囲外の値
- **期待結果**:
  - エラーメッセージが表示される
  - 値が自動的に修正される
  - 保存ボタンが無効になる

#### TC-026: 必須項目の検証

- **操作**: 必須項目を空にする
- **期待結果**:
  - エラー表示
  - 保存不可

#### TC-027: インポートデータの検証

- **入力**: 不正なJSONファイル
- **期待結果**:
  - エラーメッセージが表示される
  - 既存の設定は保持される

### 9. UI/UXテスト

#### TC-028: 変更インジケーター

- **操作**: 設定を変更
- **期待結果**:
  - 変更された項目にマークが表示される
  - hasChangesがtrueになる

#### TC-029: 離脱時の確認

- **操作**: 変更後、保存せずに離脱
- **期待結果**:
  - 確認ダイアログが表示される
  - 「保存」「破棄」「キャンセル」が選択可能

#### TC-030: プレビュー機能

- **操作**: 設定を変更
- **期待結果**:
  - プレビューエリアに即座に反映される
  - 実際の表示と一致する

### 10. レスポンシブデザインテスト

#### TC-031: モバイル表示

- **画面幅**: 375px
- **期待結果**:
  - タブまたはアコーディオン形式
  - すべての設定にアクセス可能
  - タッチ操作に最適化

#### TC-032: タブレット表示

- **画面幅**: 768px
- **期待結果**:
  - 折りたたみ可能なサイドバー
  - 適切なレイアウト

#### TC-033: デスクトップ表示

- **画面幅**: 1280px
- **期待結果**:
  - 2カラムレイアウト
  - サイドバーナビゲーション

### 11. アクセシビリティテスト

#### TC-034: キーボードナビゲーション

- **操作**: Tabキーで移動
- **期待結果**:
  - すべての要素にフォーカス可能
  - 論理的な順序
  - Enterキーで選択可能

#### TC-035: スクリーンリーダー対応

- **ツール**: NVDA/JAWS
- **期待結果**:
  - ラベルが正しく読み上げられる
  - 変更が通知される
  - エラーメッセージが読み上げられる

#### TC-036: 高コントラストモード

- **設定**: 高コントラスト有効
- **期待結果**:
  - 視認性が確保される
  - フォーカスインジケーターが明確

### 12. パフォーマンステスト

#### TC-037: 設定変更の応答速度

- **測定**: 設定変更から反映まで
- **期待結果**: < 100ms

#### TC-038: 設定の保存速度

- **測定**: 保存ボタンクリックから完了まで
- **期待結果**: < 500ms

#### TC-039: 設定の読み込み速度

- **測定**: ページロードから表示まで
- **期待結果**: < 300ms

### 13. エラーハンドリングテスト

#### TC-040: ローカルストレージ容量超過

- **条件**: ストレージがフル
- **期待結果**:
  - エラーメッセージ表示
  - 代替保存方法の提案

#### TC-041: インポートファイル破損

- **入力**: 破損したJSONファイル
- **期待結果**:
  - エラーメッセージ
  - 詳細なエラー内容
  - リカバリー方法の提示

#### TC-042: ネットワークエラー

- **条件**: オフライン状態
- **期待結果**:
  - ローカル保存は動作
  - 適切な通知

### 14. 統合テスト

#### TC-043: 設定変更からゲームプレイ

- **シナリオ**:
  1. 設定を変更
  2. 保存
  3. ゲーム画面へ遷移
  4. 設定が反映されている
- **期待結果**: すべての設定が正しく適用

#### TC-044: 複数タブでの同期

- **シナリオ**:
  1. 複数タブで開く
  2. 一つのタブで設定変更
  3. 他のタブを更新
- **期待結果**: 設定が同期される

## テスト実装優先順位

### 優先度: 高

1. TC-001〜TC-003（基本表示）
2. TC-019〜TC-021（保存/キャンセル/リセット）
3. TC-004〜TC-006（ゲームプレイ設定）

### 優先度: 中

1. TC-025〜TC-027（バリデーション）
2. TC-010〜TC-012（表示設定）
3. TC-028〜TC-030（UI/UX）

### 優先度: 低

1. TC-023〜TC-024（エクスポート/インポート）
2. TC-034〜TC-036（アクセシビリティ）
3. TC-040〜TC-042（エラーハンドリング）

## 自動化戦略

- 単体テスト: Vitest（設定ストア、バリデーション）
- コンポーネントテスト: Testing Library（UI動作）
- E2Eテスト: 手動確認（統合フロー）
