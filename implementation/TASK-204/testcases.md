# TASK-204: 部分入力モード実装 - テストケース設計

## テスト概要

部分入力モードの機能を包括的に検証し、初心者向けの学習体験を保証する。

## テストカテゴリ

### 1. 範囲計算テスト

#### TC-001: 先頭モードでの範囲計算

- **入力データ**:
  ```typescript
  text = 'つるまうかたちのぐんまけん';
  characterCount = 5;
  mode = 'start';
  ```
- **期待結果**:
  ```typescript
  range = { start: 0, end: 5, text: 'つるまうか' };
  ```

#### TC-002: 文字数が全文を超える場合

- **入力データ**:
  ```typescript
  text = 'つる';
  characterCount = 10;
  ```
- **期待結果**: 全文が対象（end = 2）

#### TC-003: ランダムモードでの範囲計算

- **入力データ**:
  ```typescript
  text = 'つるまうかたちの';
  characterCount = 3;
  mode = 'random';
  ```
- **期待結果**: ランダムな位置から3文字

#### TC-004: 1文字のみの部分入力

- **入力データ**: characterCount = 1
- **期待結果**: 最初の1文字のみ対象

### 2. 入力判定テスト

#### TC-005: 部分範囲内の正しい入力

- **前提条件**: 範囲 "つるま" (0-3)
- **入力**: "tsu", "ru", "ma"
- **期待結果**: すべて正解判定

#### TC-006: 部分範囲外の入力試行

- **前提条件**: 範囲 "つる" (0-2)
- **入力**: 3文字目以降への入力
- **期待結果**: 入力を受け付けない

#### TC-007: 部分入力完了判定

- **前提条件**: 5文字の部分入力
- **入力**: 5文字すべて正解
- **期待結果**: カード完了と判定

#### TC-008: 複数のローマ字パターン対応

- **前提条件**: "ち" が範囲内
- **入力**: "chi" または "ti"
- **期待結果**: 両方とも正解

### 3. UI表示テスト

#### TC-009: 入力対象文字のハイライト

- **前提条件**: 部分入力5文字
- **期待結果**:
  - 対象文字: 通常の明度
  - 非対象文字: 50%の透明度

#### TC-010: 設定UIの表示

- **テスト項目**:
  - スライダーの表示と動作
  - 現在値の表示
  - プリセットボタン

#### TC-011: プレビュー表示

- **入力**: 文字数変更
- **期待結果**: リアルタイムでプレビュー更新

#### TC-012: 進捗バーの調整

- **前提条件**: 10文字中5文字の部分入力
- **期待結果**: 5文字分の進捗で100%表示

### 4. 設定管理テスト

#### TC-013: 設定の保存

- **操作**: 部分入力設定を変更
- **期待結果**: LocalStorageに保存

#### TC-014: 設定の読み込み

- **前提条件**: 保存済み設定あり
- **期待結果**: 起動時に設定復元

#### TC-015: デフォルト設定

- **前提条件**: 初回起動
- **期待結果**:
  - enabled: false
  - characterCount: 5
  - mode: 'start'

#### TC-016: プリセット適用

- **操作**: "初心者"プリセット選択
- **期待結果**: 5文字、先頭モード

### 5. モード切り替えテスト

#### TC-017: 通常モードから部分入力への切り替え

- **操作**: ゲーム中に部分入力ON
- **期待結果**: 次のカードから適用

#### TC-018: 部分入力中の設定変更

- **操作**: 文字数を変更
- **期待結果**: 次のカードから適用

#### TC-019: 初心者モードとの連携

- **操作**: 初心者モード選択
- **期待結果**: 部分入力自動ON、5文字

### 6. パフォーマンステスト

#### TC-020: 範囲計算速度

- **測定項目**: 範囲計算時間
- **期待結果**: < 1ms

#### TC-021: UI更新速度

- **測定項目**: 設定変更から表示反映
- **期待結果**: < 16ms（1フレーム）

#### TC-022: メモリ使用量

- **測定項目**: 機能追加によるメモリ増加
- **期待結果**: < 1MB

### 7. 入力バリデーションテスト

#### TC-023: 範囲外文字の入力制限

- **前提条件**: 3文字の部分入力
- **入力**: 4文字目を入力試行
- **期待結果**: 入力無視、エラー表示なし

#### TC-024: Backspaceの動作

- **前提条件**: 部分入力中
- **操作**: Backspace
- **期待結果**: 範囲内でのみ戻る

#### TC-025: 部分入力でのミス判定

- **入力**: 間違った文字
- **期待結果**: 通常通りミスカウント

### 8. スコア計算テスト

#### TC-026: 部分入力時のスコア計算

- **前提条件**: 5文字の部分入力完了
- **期待結果**: 5文字分のスコア付与

#### TC-027: 正確率の計算

- **前提条件**: 5文字中1ミス
- **期待結果**: 80%の正確率

#### TC-028: WPMの調整

- **前提条件**: 部分入力モード
- **期待結果**: 入力文字数ベースで計算

### 9. アクセシビリティテスト

#### TC-029: スクリーンリーダー対応

- **テスト項目**:
  - 範囲のアナウンス
  - 設定変更の通知

#### TC-030: キーボード操作

- **テスト項目**:
  - Tab移動
  - 矢印キーでスライダー操作

#### TC-031: 色覚異常対応

- **テスト項目**: 範囲表示が色以外でも識別可能

### 10. エッジケーステスト

#### TC-032: 空文字列の処理

- **入力**: text = ""
- **期待結果**: エラーなく処理

#### TC-033: 1文字の札

- **入力**: text = "あ", count = 5
- **期待結果**: 1文字のみ対象

#### TC-034: 特殊文字を含む札

- **入力**: "ー" や "々" を含む
- **期待結果**: 正しくカウント

### 11. 統合テスト

#### TC-035: ゲームフロー全体

- **テストシナリオ**:
  1. 部分入力設定
  2. ゲーム開始
  3. 複数カード入力
  4. 結果表示
- **期待結果**: 一貫した動作

#### TC-036: 他機能との組み合わせ

- **テスト項目**:
  - 一時停止との併用
  - 統計記録
  - セーブ/ロード

### 12. レスポンシブテスト

#### TC-037: モバイル表示

- **画面幅**: 375px
- **期待結果**:
  - スライダー操作可能
  - テキスト読みやすい

#### TC-038: タブレット表示

- **画面幅**: 768px
- **期待結果**: 適切なレイアウト

#### TC-039: デスクトップ表示

- **画面幅**: 1280px
- **期待結果**: 十分な余白

## テスト実装優先順位

### 優先度: 高

1. TC-001〜TC-004（範囲計算）
2. TC-005〜TC-008（入力判定）
3. TC-013〜TC-016（設定管理）

### 優先度: 中

1. TC-009〜TC-012（UI表示）
2. TC-026〜TC-028（スコア計算）
3. TC-017〜TC-019（モード切り替え）

### 優先度: 低

1. TC-020〜TC-022（パフォーマンス）
2. TC-029〜TC-031（アクセシビリティ）
3. TC-037〜TC-039（レスポンシブ）

## 自動化戦略

- 単体テスト: Vitest
- 統合テスト: Testing Library
- E2Eテスト: Playwright（必要に応じて）
