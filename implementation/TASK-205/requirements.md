# TASK-205: 一時停止機能 - 要件定義

## 目的

ゲーム中に一時的に中断・再開できる機能を強化し、ユーザーが快適にゲームを楽しめるようにする。既存の基本的な一時停止機能を拡張し、より完成度の高い実装にする。

## 現状分析

既存実装:

- 基本的な一時停止/再開機能は実装済み
- タイマーの停止/再開は動作している
- 簡単なオーバーレイ表示はある

改善点:

- より詳細な一時停止画面の情報表示
- キーボードショートカットの改善
- 一時停止中の状態管理の強化
- アニメーションとトランジション

## 機能要件

### 1. 一時停止の起動方法 (REQ-112)

- **ボタンクリック**: 画面上の一時停止ボタン
- **ESCキー**: キーボードショートカット
- **スペースキー**: オプション（設定可能）
- **フォーカス喪失時**: ブラウザタブの切り替え時（オプション）

### 2. 一時停止中の画面表示 (REQ-203)

- **オーバーレイ表示**
  - 半透明の黒背景
  - 中央にモーダルウィンドウ
  - ゲーム画面をぼかす（blur効果）
- **表示情報**
  - 「一時停止中」の明確な表示
  - 現在の進捗（完了札数/総札数）
  - 経過時間
  - 現在のスコア
  - 再開方法の案内

### 3. 一時停止中の制御

- **入力無効化**
  - タイピング入力を受け付けない
  - ゲーム操作を無効化
- **タイマー停止**
  - 経過時間のカウントを停止
  - 一時停止時間を記録
- **状態保持**
  - 現在の入力状態を保持
  - カーソル位置を保持
  - スコア状態を保持

### 4. 再開機能

- **再開方法**
  - 「再開」ボタンクリック
  - ESCキー（トグル動作）
  - スペースキー（設定による）
- **カウントダウン表示**
  - 3-2-1のカウントダウン後に再開
  - アニメーション付き
  - スキップ可能（即座再開）

### 5. 追加機能

- **メニューアクセス**
  - 設定変更へのリンク
  - メインメニューに戻る
  - ゲーム終了オプション
- **統計表示**
  - 一時停止回数
  - 総一時停止時間
  - 平均プレイ時間

## 技術要件

### 1. コンポーネント構造

```typescript
// PauseOverlay.svelte
interface PauseOverlayProps {
	isPaused: boolean;
	gameStats: GameStats;
	onResume: () => void;
	onExit: () => void;
	onSettings?: () => void;
}

interface GameStats {
	currentCard: number;
	totalCards: number;
	elapsedTime: number;
	pauseCount: number;
	totalPauseTime: number;
	score: number;
	accuracy: number;
}
```

### 2. キーボードハンドリング

```typescript
interface PauseKeyboardHandler {
	enablePauseKey: boolean;
	pauseKey: 'Escape' | 'Space' | 'P';
	resumeWithCountdown: boolean;
	countdownDuration: number; // ミリ秒
}
```

### 3. 状態管理の拡張

```typescript
interface EnhancedPauseState {
	isPaused: boolean;
	pauseStartTime: Date | null;
	totalPauseTime: number;
	pauseCount: number;
	lastPauseDuration: number;
	pauseReason: 'manual' | 'focus_loss' | 'system';
}
```

## UI/UX要件

### 1. ビジュアルデザイン

- **オーバーレイ**
  - 背景: rgba(0, 0, 0, 0.7)
  - backdrop-filter: blur(4px)
  - トランジション: 300ms ease-in-out
- **モーダルウィンドウ**
  - 背景: 白
  - 角丸: 16px
  - 影: 大きめのドロップシャドウ
  - 最大幅: 500px

### 2. アニメーション

- **表示時**
  - フェードイン（opacity）
  - スケール（0.95 → 1.0）
- **非表示時**
  - フェードアウト
  - スケール（1.0 → 0.95）
- **カウントダウン**
  - 数字のパルスアニメーション
  - プログレスバーまたはサークル

### 3. レスポンシブデザイン

- **デスクトップ**: フルサイズモーダル
- **タブレット**: 画面幅の80%
- **モバイル**: 全画面表示

## 受け入れ基準

### 必須要件

1. [ ] ESCキーで一時停止/再開ができる
2. [ ] 一時停止中は入力を受け付けない
3. [ ] タイマーが正しく停止・再開する
4. [ ] オーバーレイが適切に表示される
5. [ ] 再開時のカウントダウンが動作する

### 品質基準

1. [ ] アニメーションがスムーズ（60fps）
2. [ ] キーボード操作が直感的
3. [ ] 状態遷移にバグがない
4. [ ] アクセシビリティ対応

## パフォーマンス目標

- 一時停止の応答時間: < 50ms
- アニメーション: 60fps維持
- メモリ使用量: 最小限

## テスト戦略

### 単体テスト

- 一時停止/再開のロジック
- タイマー管理
- キーボードハンドリング

### 統合テスト

- ゲームフローとの統合
- 状態管理の整合性
- UI表示の正確性

### E2Eテスト

- 実際のゲームプレイ中の動作
- 複数回の一時停止/再開
- エッジケース（連続押下など）

## 実装の優先順位

1. キーボードショートカットの改善
2. カウントダウン機能
3. 詳細情報表示
4. アニメーション強化
5. 追加メニュー機能

## 将来の拡張性

- 一時停止中のミニゲーム
- 休憩リマインダー
- 一時停止統計の詳細分析
- カスタマイズ可能なショートカット
