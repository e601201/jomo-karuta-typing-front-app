# TASK-303: ランダム出題モード テストケース設計

## テストケース一覧

### 1. シャッフル機能のテスト

#### TC-001: 基本的なシャッフル動作
- **目的**: カードデックが正しくシャッフルされることを確認
- **前提条件**: 44枚のカードデータが存在
- **テスト手順**:
  1. RandomModeServiceをインスタンス化
  2. shuffleCards()を実行
  3. 結果の配列を確認
- **期待結果**:
  - 44枚すべてのカードが含まれる
  - 元の順序と異なる（高確率で）

#### TC-002: シャッフルのランダム性
- **目的**: シャッフルが毎回異なる結果を生成することを確認
- **前提条件**: 44枚のカードデータが存在
- **テスト手順**:
  1. 100回シャッフルを実行
  2. 各結果を比較
- **期待結果**:
  - すべての結果が異なる（統計的に高確率で）

#### TC-003: 分布の均等性
- **目的**: 各カードが各位置に均等に出現することを確認
- **前提条件**: 44枚のカードデータが存在
- **テスト手順**:
  1. 1000回シャッフルを実行
  2. 各位置での各カードの出現回数を記録
- **期待結果**:
  - 各カードが各位置に約22.7回（1000/44）出現（±20%の範囲内）

### 2. 重複なし保証のテスト

#### TC-004: 同一セッション内での重複チェック
- **目的**: 1セッション内で同じカードが2回出題されないことを確認
- **前提条件**: ランダムモードでゲーム開始
- **テスト手順**:
  1. セッションを開始
  2. 44枚すべてを取得
  3. 出題されたカードを記録
- **期待結果**:
  - 各カードが正確に1回ずつ出題される
  - 重複がない

#### TC-005: カード数の整合性
- **目的**: シャッフル後もカード数が保持されることを確認
- **前提条件**: 44枚のカードデータ
- **テスト手順**:
  1. シャッフル前のカード数を確認
  2. シャッフル実行
  3. シャッフル後のカード数を確認
- **期待結果**:
  - シャッフル前後でカード数が44枚で一致

### 3. セッション管理のテスト

#### TC-006: セッション開始時のシャッフル
- **目的**: 新規セッション開始時に自動的にシャッフルされることを確認
- **前提条件**: ランダムモードを選択
- **テスト手順**:
  1. startSession()を実行
  2. getNextCard()で最初のカードを取得
- **期待結果**:
  - カードがシャッフルされた順序で取得される
  - 初期状態と異なる順序

#### TC-007: セッション途中終了と再開
- **目的**: 途中終了後も残りのカードの順序が保持されることを確認
- **前提条件**: ランダムモードでセッション実行中
- **テスト手順**:
  1. 10枚まで進行
  2. セッションを保存
  3. 新規インスタンスで復元
  4. 残り34枚を取得
- **期待結果**:
  - 11枚目から44枚目まで正しい順序で取得
  - 重複なし

#### TC-008: セッション完了の検出
- **目的**: 44枚すべて出題後にセッション完了が検出されることを確認
- **前提条件**: ランダムモードでセッション実行中
- **テスト手順**:
  1. 44枚すべてを取得
  2. isSessionComplete()を確認
- **期待結果**:
  - 44枚目でtrueを返す
  - 45枚目の取得試行でnullまたはエラー

### 4. エッジケースのテスト

#### TC-009: 空のカードデックでの初期化
- **目的**: カードデータがない場合の挙動を確認
- **前提条件**: カードデータが空
- **テスト手順**:
  1. 空配列で初期化
  2. shuffleCards()を実行
- **期待結果**:
  - エラーが発生しない
  - 空配列が返される

#### TC-010: 1枚のカードでのシャッフル
- **目的**: カードが1枚の場合の挙動を確認
- **前提条件**: カードデータが1枚
- **テスト手順**:
  1. 1枚のカードで初期化
  2. shuffleCards()を実行
- **期待結果**:
  - エラーが発生しない
  - 同じ1枚が返される

### 5. パフォーマンステスト

#### TC-011: シャッフル処理時間
- **目的**: シャッフル処理が100ms以内に完了することを確認
- **前提条件**: 44枚のカードデータ
- **テスト手順**:
  1. 処理開始時刻を記録
  2. shuffleCards()を実行
  3. 処理時間を計測
- **期待結果**:
  - 100ms以内に完了

#### TC-012: メモリ使用量
- **目的**: メモリ使用量が適切であることを確認
- **前提条件**: 44枚のカードデータ
- **テスト手順**:
  1. 初期メモリ使用量を記録
  2. 100回シャッフルを実行
  3. メモリ使用量の増加を確認
- **期待結果**:
  - メモリリークがない
  - 使用量が一定範囲内

### 6. 統合テスト

#### TC-013: GameManagerとの連携
- **目的**: GameManagerクラスと正しく連携することを確認
- **前提条件**: GameManagerインスタンス
- **テスト手順**:
  1. mode: 'random'で初期化
  2. ゲームを進行
- **期待結果**:
  - ランダム順序でカードが出題される
  - GameManagerの他の機能が正常動作

#### TC-014: ストアとの連携
- **目的**: gameStoreと正しく連携することを確認
- **前提条件**: gameStore初期化済み
- **テスト手順**:
  1. ランダムモードでセッション開始
  2. ストアの状態を確認
- **期待結果**:
  - mode: 'random'が設定される
  - カード順序が正しく保存される

## テスト実装優先順位

1. **Priority 1 (必須)**
   - TC-001: 基本的なシャッフル動作
   - TC-004: 同一セッション内での重複チェック
   - TC-006: セッション開始時のシャッフル

2. **Priority 2 (重要)**
   - TC-002: シャッフルのランダム性
   - TC-007: セッション途中終了と再開
   - TC-008: セッション完了の検出

3. **Priority 3 (推奨)**
   - TC-003: 分布の均等性
   - TC-011: シャッフル処理時間
   - TC-013: GameManagerとの連携

4. **Priority 4 (オプション)**
   - TC-009: 空のカードデックでの初期化
   - TC-010: 1枚のカードでのシャッフル
   - TC-012: メモリ使用量
   - TC-014: ストアとの連携