# 上毛カルタタイピングゲーム 要件定義書

## 概要

群馬県の郷土カルタである「上毛カルタ」の読み札を使用した教育的タイピングゲームアプリケーション。地域文化の学習とタイピングスキル向上を同時に実現し、全年齢層のユーザーが楽しみながら群馬県の歴史・文化・地理を学べることを目的とする。

## ユーザストーリー

### ストーリー1: 地域文化学習とタイピング練習

- **である** 群馬県民または群馬県に興味がある学習者 **として**
- **私は** 上毛カルタの読み札をタイピングしながら群馬県について学ぶ **ことをしたい**
- **そうすることで** 楽しみながら地域文化の知識とタイピングスキルを同時に向上させることができる

### ストーリー2: 段階的学習機能

- **である** タイピング初心者または子供 **として**
- **私は** 部分入力機能を使って練習 **したい**
- **そうすることで** 自分のレベルに合わせて無理なく学習を進められる

### ストーリー3: 学習進捗管理

- **である** 継続的な学習者 **として**
- **私は** 自分の学習進捗や成績の推移を確認 **したい**
- **そうすることで** モチベーションを維持しながら計画的に学習できる

### ストーリー4: 対戦モード（次期開発）

- **である** 上毛カルタ競技参加者 **として**
- **私は** 実際の競技に近い形式で練習 **したい**
- **そうすることで** 競技会に向けた実践的な訓練ができる

## 機能要件（EARS記法）

### 通常要件（SHALL）

- REQ-001: システムは上毛カルタの全44枚の読み札データを保持しなければならない
- REQ-002: システムは読み札を画面に表示しなければならない
- REQ-003: システムはユーザーのローマ字入力をリアルタイムで判定し、正誤を即座にフィードバックしなければならない
- REQ-004: システムは入力中の文字を視覚的にハイライト表示しなければならない
- REQ-005: システムは各札の正解時間、誤入力回数、総合スコアを記録しなければならない
- REQ-006: システムは学習済み札と未学習札を区別して管理しなければならない
- REQ-007: システムは練習モードを提供しなければならない
- REQ-008: システムは部分入力モード（初心者向け）を提供しなければならない

### 条件付き要件（WHEN/IF-THEN）

#### ゲームモード関連

- REQ-101: 「練習モード」が選択された場合、システムは時間制限なしで全札を順番に出題しなければならない
- REQ-102: 「特定札練習」が選択された場合、システムはユーザーが選択した札のみを繰り返し出題しなければならない
- REQ-103: 「ランダム出題」が選択された場合、システムは札をランダムな順序で出題しなければならない

#### 難易度設定関連

- REQ-104: 「部分入力モード」が有効な場合、システムは最初の指定文字数（3-10文字）の入力で正解判定しなければならない
- REQ-105: 「完全入力モード」が有効な場合、システムは全文字の正確な入力を要求しなければならない
- REQ-106: 初心者向けモードが選択された場合、システムは部分入力を自動的に有効化しなければならない

#### 入力判定関連

- REQ-107: 正しい文字が入力された場合、システムは緑色でハイライト表示しなければならない
- REQ-108: 誤った文字が入力された場合、システムは赤色でエラー表示し、誤入力された文字のみを自動的に削除しなければならない
- REQ-109: バックスペースキーが押された場合、システムは入力を無視し、手動での文字削除を許可してはならない
- REQ-110: エンターキーが押された場合、システムは入力を無視し、全文字入力完了まで次の札に進んではならない

#### ゲーム進行関連

- REQ-111: 各札の全文字入力が完了した場合、システムは自動的に次の札に進まなければならない
- REQ-114: 全ての札が完了した場合、システムは成績サマリー画面を表示しなければならない
- REQ-112: 一時停止ボタンが押された場合、システムはゲームを中断し、再開可能な状態を維持しなければならない
- REQ-113: ゲーム中にブラウザを閉じた場合、システムは次回起動時に進捗を復元できるようデータを保存しなければならない

### 状態要件（WHERE）

- REQ-201: ゲーム待機状態にある場合、システムはメニュー選択とゲーム設定変更を受け付けなければならない
- REQ-202: ゲーム進行中の場合、システムはキーボード入力を常に監視し処理しなければならない
- REQ-203: 一時停止状態の場合、システムは入力を無効化し、タイマーを停止しなければならない
- REQ-204: 結果表示状態の場合、システムは詳細な成績データと改善ポイントを表示しなければならない
- REQ-205: 札解説表示状態の場合、システムは該当札の歴史的・文化的背景情報を表示しなければならない

### オプション要件（MAY）

- REQ-301: システムは読み札の音声読み上げ機能を提供してもよい
- REQ-302: システムはBGMや効果音の設定機能を提供してもよい
- REQ-303: システムは札の解説情報（歴史的背景、地理情報等）を表示する機能を提供してもよい
- REQ-304: システムは絵札のヒント画像表示機能を提供してもよい
- REQ-305: システムは学習記録のエクスポート機能を提供してもよい
- REQ-306: システムはカスタムテーマ（配色変更）機能を提供してもよい
- REQ-307: システムはチャレンジモード（制限時間内での得点競争）を提供してもよい
- REQ-308: システムは競技モード（実際の競技ルールに準拠）を提供してもよい（次期開発）
- REQ-309: システムは他のユーザーとの対戦機能を提供してもよい（次期開発）
- REQ-310: システムはオンラインランキング機能を提供してもよい（次期開発）

### 制約要件（MUST）

- REQ-401: システムはローマ字入力による日本語入力を正確に処理しなければならない
- REQ-402: システムはIME（日本語入力システム）の状態を適切に管理しなければならない
- REQ-403: システムはブラウザのセキュリティポリシーに準拠した方法でデータを保存しなければならない
- REQ-404: システムは個人情報を収集する場合、プライバシーポリシーに従って処理しなければならない
- REQ-405: システムは著作権に配慮し、上毛カルタの使用許諾範囲内で動作しなければならない

## 非機能要件

### パフォーマンス要件

- NFR-001: キー入力から画面反映までの遅延は30ms以下でなければならない
- NFR-002: 札の切り替え時の画面遷移は100ms以内に完了しなければならない
- NFR-003: 初回ページ読み込みは2秒以内に完了しなければならない
- NFR-004: メモリ使用量は500MB以下を維持しなければならない
- NFR-005: 1000回の連続入力でもパフォーマンス劣化が10%以内に収まらなければならない

### セキュリティ要件

- NFR-101: ユーザーデータはブラウザのローカルストレージに暗号化して保存されなければならない
- NFR-102: 外部APIとの通信はHTTPSプロトコルを使用しなければならない
- NFR-103: XSS攻撃に対する適切なサニタイズ処理を実装しなければならない
- NFR-104: CSRF攻撃に対する防御機構を実装しなければならない

### ユーザビリティ要件

- NFR-201: UIは5歳以上のユーザーが直感的に操作できる設計でなければならない
- NFR-202: 重要な操作には確認ダイアログを表示しなければならない
- NFR-203: エラーメッセージは具体的で理解しやすい日本語で表示されなければならない
- NFR-204: キーボードショートカットは一般的な規約に従わなければならない
- NFR-205: タブキーによるフォーカス移動が論理的な順序で行われなければならない

### アクセシビリティ要件

- NFR-301: WCAG 2.1 Level AAに準拠しなければならない
- NFR-302: 最小フォントサイズは14px以上でなければならない
- NFR-303: カラーコントラスト比は4.5:1以上を維持しなければならない
- NFR-304: スクリーンリーダーに対応した適切なARIA属性を設定しなければならない
- NFR-305: キーボードのみで全機能が操作可能でなければならない

### 互換性要件

- NFR-401: Chrome 100+、Firefox 100+、Safari 15+、Edge 100+で動作しなければならない
- NFR-402: Windows 10/11、macOS 11+、Ubuntu 20.04+で動作しなければならない
- NFR-403: 画面解像度1280x720以上のデバイスで適切に表示されなければならない
- NFR-404: タブレット端末（iPad、Android Tablet）で基本機能が使用可能でなければならない

## Edgeケース

### エラー処理

- EDGE-001: ネットワーク接続が切断された場合、オフラインモードに自動切り替えし、ローカルデータのみで動作を継続する
- EDGE-002: ローカルストレージが満杯の場合、古いデータを自動削除して新しいデータを保存する
- EDGE-003: ブラウザがクラッシュした場合、次回起動時に前回の進捗を復元する
- EDGE-004: 不正なデータが入力された場合、デフォルト値にフォールバックして動作を継続する
- EDGE-005: JavaScriptが無効化されている場合、適切なエラーメッセージを表示する

### 境界値処理

- EDGE-101: 制限時間が0秒に設定された場合、最小値10秒に自動調整する
- EDGE-102: 制限時間が9999秒を超えた場合、最大値9999秒に自動調整する
- EDGE-103: 同一文字が100回以上連続入力された場合、スパム判定して入力を制限する
- EDGE-104: 入力速度が1秒間に50文字を超えた場合、不正入力として警告を表示する
- EDGE-105: 保存データが10MBを超えた場合、古いデータから順に削除する

### ユーザー操作異常

- EDGE-201: 複数のキーが同時に押された場合、最初に検知したキーのみを処理する
- EDGE-202: IMEが予期せず切り替わった場合、自動的に適切なモードに戻す
- EDGE-203: ブラウザの戻る/進むボタンが押された場合、確認ダイアログを表示する
- EDGE-204: ページリロードが実行された場合、ゲーム状態を可能な限り復元する
- EDGE-205: コピー＆ペーストが試みられた場合、これを無効化してメッセージを表示する
- EDGE-206: バックスペースキーが押された場合、入力を無視して文字削除を防ぐ
- EDGE-207: エンターキーが押された場合、入力を無視してスキップを防ぐ

### システム環境異常

- EDGE-301: メモリ不足が検出された場合、不要なリソースを解放して動作を継続する
- EDGE-302: CPUが高負荷状態の場合、アニメーション品質を自動的に低下させる
- EDGE-303: 画面サイズが極端に小さい場合、モバイル用レイアウトに自動切り替えする
- EDGE-304: 日本語フォントが利用できない場合、代替フォントで表示する
- EDGE-305: サードパーティCookieがブロックされている場合、ローカルストレージのみで動作する

## 受け入れ基準

### 機能テスト

#### 基本機能

- [ ] 上毛カルタ全44枚の読み札が正しく表示される
- [ ] ローマ字入力で正しく動作する
- [ ] 部分入力モードで指定文字数での正解判定が機能する
- [ ] 完全入力モードで全文字一致の判定が機能する

#### ゲームモード

- [ ] 練習モードで全札を順番に練習できる
- [ ] 特定札練習で選択した札のみが出題される
- [ ] ランダム出題モードで札がランダムに出題される
- [ ] 部分入力モードで指定文字数での正解判定が機能する

#### 入力・表示機能

- [ ] 正しい文字入力時に緑色ハイライトが表示される
- [ ] 誤った文字入力時に赤色エラー表示後、誤入力文字が自動削除される
- [ ] バックスペースキーが無効化されている
- [ ] エンターキーが無効化され、スキップできない
- [ ] 全文字入力完了後に自動的に次の札に進む
- [ ] 一時停止・再開機能が正しく動作する
- [ ] 初心者向けモードで部分入力が有効化される

#### データ管理

- [ ] 学習進捗が正しく記録・保存される
- [ ] 成績データが正確に集計される
- [ ] 設定値が次回起動時に復元される
- [ ] ゲーム中断時の進捗が次回起動時に復元される

### 非機能テスト

#### パフォーマンステスト

- [ ] キー入力レスポンスが30ms以下
- [ ] 札切り替えが100ms以内
- [ ] 初回読み込みが2秒以内
- [ ] メモリ使用量が500MB以下
- [ ] 1000回連続入力でも安定動作

#### 互換性テスト

- [ ] Chrome最新版で全機能が動作
- [ ] Firefox最新版で全機能が動作
- [ ] Safari最新版で全機能が動作
- [ ] Edge最新版で全機能が動作
- [ ] Windows環境で正常動作
- [ ] macOS環境で正常動作
- [ ] タブレット端末で基本機能が動作

#### アクセシビリティテスト

- [ ] キーボードのみで全操作が可能
- [ ] スクリーンリーダーで読み上げ可能
- [ ] カラーコントラスト比が基準を満たす
- [ ] フォントサイズが適切
- [ ] タブ順序が論理的

### Edgeケーステスト

#### 異常系テスト

- [ ] ネットワーク切断時のオフライン動作
- [ ] ブラウザクラッシュ後の復元機能
- [ ] 不正データ入力時のエラーハンドリング
- [ ] メモリ不足時の動作継続
- [ ] 同時キー押下時の処理

#### 境界値テスト

- [ ] 制限時間の最小値・最大値設定
- [ ] 連続同一文字入力の制限
- [ ] 高速入力時の警告表示
- [ ] データサイズ上限時の動作

#### セキュリティテスト

- [ ] XSS攻撃への耐性
- [ ] データの暗号化保存
- [ ] HTTPSでの通信
- [ ] コピー＆ペーストの無効化

## 実装優先順位

### Phase 1: MVP（最小実行可能製品） - 約1ヶ月

1. 基本的な札表示機能（上毛カルタ44枚のデータ管理）
2. キーボード入力判定とリアルタイムフィードバック
3. 練習モードの実装（全札順番出題）
4. 部分入力モード（初心者向け）
5. ローカルストレージでの進捗保存
6. 基本的なUI/UXデザイン

### Phase 2: 基本機能拡充 - 約2週間

1. 特定札練習モード
2. ランダム出題モード
3. 成績記録と簡単な統計表示
4. 一時停止・再開機能
5. 初心者向けモード（部分入力自動有効化）

### Phase 3: オプション機能 - 将来的な拡張

1. 札の解説情報表示
2. 絵札のヒント画像表示
3. BGM・効果音設定
4. カスタムテーマ（配色変更）
5. 学習記録のエクスポート

### Phase 4: 次期開発 - 将来構想

1. チャレンジモード（制限時間内スコア競争）
2. 競技モード（実際の競技ルール準拠）
3. 音声読み上げ機能
4. オンラインランキング
5. マルチプレイヤー対戦機能

## 技術仕様

### 現行開発（Phase 1-2）

- **フレームワーク**: SvelteKit 2 + Svelte 5
- **スタイリング**: Tailwind CSS 4.0
- **言語**: TypeScript (strict mode)
- **状態管理**: Svelte Store + Context API
- **データ永続化**: LocalStorage / IndexedDB
- **テスト**: Vitest + Playwright
- **デプロイ**: Vercel
- **パッケージマネージャー**: bun

### 次期開発（Phase 3-4）

- **バックエンド**: Supabase
  - **認証**: Supabase Auth（ソーシャルログイン対応）
  - **データベース**: PostgreSQL（Supabase Database）
  - **リアルタイム通信**: Supabase Realtime（対戦機能用）
  - **ストレージ**: Supabase Storage（ユーザーアバター、カスタムテーマ等）
  - **エッジファンクション**: Supabase Edge Functions（サーバーサイドロジック）
- **フロントエンド統合**: @supabase/supabase-js
- **型安全性**: Supabase CLI による TypeScript 型自動生成

## 補足情報

### 上毛カルタについて

上毛カルタは1947年に創刊された群馬県の郷土カルタで、群馬県の歴史、文化、人物、産業、自然などを44枚の札で表現しています。「つ」で始まる「鶴舞う形の群馬県」など、群馬県民なら誰もが知る読み札で構成されており、県民の郷土愛を育む重要な文化財として位置づけられています。

### 教育的価値

本アプリケーションは単なるタイピング練習ツールではなく、群馬県の歴史や文化を学ぶ教育ツールとしての側面も持ちます。各札には詳細な解説を付与し、ゲームを通じて自然に郷土知識が身につく設計となっています。

### 今後の展開

将来的には他の地域の郷土カルタ（江戸いろはカルタ、京いろはカルタなど）にも対応し、日本全国の郷土文化学習プラットフォームへと発展させることを視野に入れています。
